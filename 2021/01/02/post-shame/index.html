<!doctype html><html lang=en><head><title>The Post of Shame - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="So this site has been down since at least July 9, 2019 (according to my email). And the reasons were pretty simple &ndash; and dumb. This post is going to be a sort of post-mortem on why it failed and what the fixes were. And (hopefully) it&rsquo;ll include some lessons learned.
About the Site This site runs on apache2 on a debian-stable server. The underlying site is written in Django. The entire site is supposed to be self-maintaining."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2021/01/02/post-shame/>The Post of Shame</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/post-shame.md><header class=entry-header><h1 class=entry-title><a href=/2021/01/02/post-shame/>The Post of Shame</a></h1><p class=entry-info>Published on <time>Sat, Jan 2, 2021</time>
in Infrastructure</p></header><div class=entry-body><p>So this site has been down since at least July 9, 2019 (according to my email). And the reasons were pretty simple &ndash; and dumb. This post is going to be a sort of post-mortem on why it failed and what the fixes were. And (hopefully) it&rsquo;ll include some lessons learned.</p><h1 id=about-the-site>About the Site</h1><p>This site runs on apache2 on a debian-stable server. The underlying site is written in <a href=https://www.djangoproject.com/>Django</a>. The entire site is supposed to be self-maintaining. This happens via a combination of Debian&rsquo;s <a href=https://wiki.debian.org/UnattendedUpgrades>unattentded-upgrades</a> capabilities and a homebrew <a href=https://github.com/spresse1/pressers.name/blob/master/django-autoupdate>django-autoupdate script</a>. Django, in turn, is backed by a MySQL database.</p><p>In order to be able to cleanly attempt upgrades,</p><h1 id=so-what-happened>So What Happened?</h1><p>Simply put, Debian Buster released (<a href=https://en.wikipedia.org/wiki/Debian_version_history#Debian_10_(Buster)>on July 6, 2019</a>) and I wasn&rsquo;t prepared. This release upgraded python. Normally that&rsquo;s not a big issue. Except that I had hard-coded the python version in the site configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;IfModule</span> <span style=color:#960050;background-color:#1e0010>mod_ssl.c</span><span style=color:#f92672>&gt;</span>  
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;VirtualHost</span> <span style=color:#960050;background-color:#1e0010>*:443</span><span style=color:#f92672>&gt;</span>  
</span></span><span style=display:flex><span>        ServerName pressers.name:443  
</span></span><span style=display:flex><span>        DocumentRoot /var/www/html  
</span></span><span style=display:flex><span>        WSGIDaemonProcess pressers_name python-path=/var/www/pressers.name:/var/www/pressers.name/lib/python3.5/site-packages  
</span></span><span style=display:flex><span>       WSGIScriptAlias / /var/www/pressers.name/pressers_name/wsgi.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[ snip ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/VirtualHost&gt;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/IfModule&gt;</span>
</span></span></code></pre></div><p>See the <code>WSGIDaemonProcess</code> line? And how I hardcoded python3.5 into that? The Debian Buster upgrade brought with it python3.7, so Apache was trying to run the WSGI script using non-existent files. D&rsquo;oh!</p><p>The (temporary) fix is simple: Adjust the hardcoded path to point to python3.7, which came with Buster.</p><h1 id=the-permanent-fix>The Permanent Fix</h1><p>Is just two lines, added to <a href=https://github.com/spresse1/pressers.name/commit/28249500a9af49f0775df1853871451265f3c316>the environment build</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>PYPATH<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ls -d lib/python* | sort | tail -n 1<span style=color:#66d9ef>)</span>  
</span></span><span style=display:flex><span>ln -s <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>basename $PYPATH<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;lib/python&#34;</span>
</span></span></code></pre></div><p>These two lines create a &ldquo;python&rdquo; directory in lib (in the virtualenv) which points to the latest python. Unlike the typical python directory in lib, this one doesn&rsquo;t include the version number, which will let us put it in the apache configuration file &ndash; and to not have to update the apache config when the python version changes!</p><h1 id=root-cause>Root Cause</h1><p>Root cause is a hardcoded path that was no longer valid. This is a pretty simple, dumb mistake and I should have seen it coming. So the biggest lesson: make sure you&rsquo;re not hardcoding things!</p><p>There&rsquo;s also a second lesson here: Don&rsquo;t make assumptions about the OS under you maintaining backwards compatibility.  When I first built this site, CI/CD pipelines were not in as common use. Building something that spun up a fresh webserver to test the site every night would have been a huge effort. So I didn&rsquo;t. Today CI/CD pipelines are much more featureful and robust &ndash; maybe it&rsquo;s time I look at one for this site.</p><h1 id=long-term>Long Term</h1><p>In fixing this and updating other things that had had minor failures, I discovered that the engine I&rsquo;m using to run this blog (zinnia) is now a dead project. It will not be updated to work with Django 3, which limits this site to working with Django 2. Django 2 is End of Life on 01 April, 2022. So I have until then to move things off&mldr;</p><p>In the time since I set this site up, I&rsquo;ve become a fan of building simple sites using things like <a href=https://blog.getpelican.com/>pelican</a>. This site doesn&rsquo;t have anything truly interactive; why back it with something that takes as much maintenance and effort as Django if I am not taking advantage of those capabilities?</p><p>So I will likely move towards something like that for building sites. HTML will never go end of life out from under me.</p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=/2022/04/03/website-hosting-changed/>Website hosting changed</a></li><li><a href=/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=/categories/3d-printing/>3D Printing</a></li><li><a href=/categories/acm/>ACM</a></li><li><a href=/categories/acm-cluster/>ACM Cluster</a></li><li><a href=/categories/cyberlaw/>Cyberlaw</a></li><li><a href=/categories/cybersecurity/>Cybersecurity</a></li><li><a href=/categories/germany/>Germany</a></li><li><a href=/categories/infrastructure/>Infrastructure</a></li><li><a href=/categories/life-in-germany/>Life in Germany</a></li><li><a href=/categories/links/>Links</a></li><li><a href=/categories/presentations/>Presentations</a></li><li><a href=/categories/projects/>Projects</a></li><li><a href=/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>