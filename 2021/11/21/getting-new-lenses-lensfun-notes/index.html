<!doctype html><html lang=en><head><title>Getting new lenses for Lensfun - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Since moving to Germany, I&rsquo;ve started taking pictures. Lots here is beautiful, and my cell phone camera just didn&rsquo;t seem to be cutting it. So I bought a camera &ndash; a (used) Canon G5 X. The photos at the top and bottom of this post are a couple I&rsquo;m proud of.
Of course, using a real camera means using real photo editing software. I run Linux on my laptop. Specifically, at the moment, Ubuntu."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/new-lenses-lensfun.md><header class=entry-header><h1 class=entry-title><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></h1><p class=entry-info>Published on <time>Sun, Nov 21, 2021</time>
in Germany, Life in Germany</p></header><div class=entry-body><p><img src=/static/images/stuttgart-rose.jpg alt="Rosen sind rot&amp;hellip; And yes, by another name, they do still smell sweet! The focus of this image is two red roses seen from the side, positioned in the right-hand third of the picture and in focus. The rest of the image is out of focus. The power half of the image is rows of distant green grape vines. The next quarter of the image is out-of-focus homes, mostly white with red-orange roofs. And the last quarter right at the top of the image is a mostly cloudy sky."></p><p>Since moving to Germany, I&rsquo;ve started taking pictures. Lots here is beautiful, and my cell phone camera just didn&rsquo;t seem to be cutting it. So I bought a camera &ndash; a (used) <a href="https://www.usa.canon.com/internet/portal/us/home/explore/powershot-g-series/powershot-g5-x/explore-powershot-g-series-family-g5-x-rte/!ut/p/z1/lZJLb4JAEMc_iwePm5kF5HEEH6VGErFVZC-G4qKksktwI9pPXzTG2BppuqeZyW8e_5kFBktgIjnkm0TlUiS7xo-ZuQpC3_Zf-zh5saYjdMfvQ8fULK8fmhBdAHzyXAR2n2_bMw_dYIAjGhoazrRrfgvA2vsvgAEr03wNse5kDs-QEk1PM2JQe00SjTauQR3dMqmZ9pwznQpVqi3EaSKkWAle1_xjlUqhuFBd3MqCd5Efy52sGqOUNa_2W6nIhux5lfP9j1iPHG8weWRJlhT57nThSKX4b7mPelj7NqOzgPsKuPAMdE1n0Ne10Rm6Ai014mYG6-kMgQXRIec1zIWsiuYLvP1zwz7C-K-rRR7Ek-XX1K-BUSiL-byw9RP5zIKhbrDQ7XS-AaztfXg!/dz/d5/L2dBISEvZ0FBIS9nQSEh/?urile=wcm%3Apath%3A%2Fcanon_newweb_content%2Fhome%2Fexplore%2Fpowershot-g-series%2Fpowershot-g5-x%2Fexplore-powershot-g-series-family-g5-x-rte">Canon G5 X</a>. The photos at the top and bottom of this post are a couple I&rsquo;m proud of.</p><p>Of course, using a real camera means using real photo editing software. I run Linux on my laptop. Specifically, at the moment, Ubuntu. Ubuntu comes with <a href=https://wiki.gnome.org/Apps/Shotwell>ShotWell</a>. I chose to shoot raw photos, so that I would have the maximum flexibility in editing them. In turn, this means I need software that can edit raw photos. For that, I chose <a href=https://www.darktable.org/>DarkTable</a> (which could probably do all the photo management, but I just haven&rsquo;t gotten around to trying that workflow).</p><p>I&rsquo;ve only got one major pain point with DarkTable: Lens correction. When a camera takes a photo, the lens typically causes certain distortions. For digital cameras, these are easily corrected in software &ndash; if you know what the distortions caused by the lens are. Most cameras can correct automatically. However, when shooting raw photos, my camera does not. And although DarkTable can do this automatically, it doesn&rsquo;t have the correct information for my camera in order to be able to do it!</p><p>If my camera were new, this wouldn&rsquo;t be particularly surprising. But it was released 4 years ago &ndash; how is this information still missing? After digging in, it turns out Darktable relies on a library called <a href=http://lensfun.github.io/>LensFun</a> for lens correction. Lens fun hasn&rsquo;t done a release in a while and (by policy), Ubuntu doesn&rsquo;t pull in updates to software until the software does a release. So no lens profile for me.</p><p>This means automatic correction doesn&rsquo;t properly get applied to my lens. Instead, I had to manually select the Canon G7X for every image &ndash; and I&rsquo;m lucky it uses the same lens, or I&rsquo;d be out of luck for lens correction entirely!</p><p>So let&rsquo;s get this problem fixed.</p><h1 id=finding-the-lens-correction-information>Finding the Lens Correction Information</h1><p>A site related to LensFun <a href=https://wilson.bronger.org/lensfun_coverage.html>lists my camera as supported</a> in &ldquo;dev&rdquo;. So lets go find that support &ndash; maybe we can insert it somewhere. After some hunting, I <a href=https://github.com/lensfun/lensfun/blob/master/data/db/compact-canon.xml#L78>found the data blob</a> that contains the lens information for my camera.</p><h1 id=finding-the-files-on-disk>Finding the files on disk</h1><p>We know we&rsquo;re looking for a file called &ldquo;compact-canon.xml&rdquo;. So let&rsquo;s see if we can find it on disk:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ find / -name compact-canon.xml 2&gt;/dev/null
</span></span></code></pre></div><p>This looks through the entire disk for a file named &ldquo;compact-canon.xml&rdquo;. The text of any errors goes to <code>/dev/null</code> (which automatically discards it).</p><p>It turns out Ubuntu has that file at <code>/usr/share/lensfun/version_1/compact-canon.xml</code>.</p><h1 id=performing-the-update>Performing the update</h1><p>So. Let&rsquo;s add the lens definition. I don&rsquo;t like making big changes, so I&rsquo;m going to make the minimal change required for the lens correction to work. That means I&rsquo;m just going to edit the file we found in the previous step and add the relevant lines.</p><p>I chose to add the lines after those for the Canon G7 X, which mirrors the setup in the official file.</p><p>These are the lines I added:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#f92672>&lt;camera&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maker&gt;</span>Canon<span style=color:#f92672>&lt;/maker&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model&gt;</span>Canon PowerShot G5 X<span style=color:#f92672>&lt;/model&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model</span> <span style=color:#a6e22e>lang=</span><span style=color:#e6db74>&#34;en&#34;</span><span style=color:#f92672>&gt;</span>PowerShot G5 X (3:2)<span style=color:#f92672>&lt;/model&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;mount&gt;</span>canonG7X<span style=color:#f92672>&lt;/mount&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;cropfactor&gt;</span>2.72<span style=color:#f92672>&lt;/cropfactor&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/camera&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;camera&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maker&gt;</span>Canon<span style=color:#f92672>&lt;/maker&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model&gt;</span>Canon PowerShot G5 X 4:3<span style=color:#f92672>&lt;/model&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model</span> <span style=color:#a6e22e>lang=</span><span style=color:#e6db74>&#34;en&#34;</span><span style=color:#f92672>&gt;</span>PowerShot G5 X (4:3)<span style=color:#f92672>&lt;/model&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;mount&gt;</span>canonG7X<span style=color:#f92672>&lt;/mount&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;cropfactor&gt;</span>2.94<span style=color:#f92672>&lt;/cropfactor&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/camera&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;camera&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;maker&gt;</span>Canon<span style=color:#f92672>&lt;/maker&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model&gt;</span>Canon PowerShot G5 X 16:9<span style=color:#f92672>&lt;/model&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;model</span> <span style=color:#a6e22e>lang=</span><span style=color:#e6db74>&#34;en&#34;</span><span style=color:#f92672>&gt;</span>PowerShot G5 X (16:9)<span style=color:#f92672>&lt;/model&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;mount&gt;</span>canonG7X<span style=color:#f92672>&lt;/mount&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;cropfactor&gt;</span>2.85<span style=color:#f92672>&lt;/cropfactor&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/camera&gt;</span>
</span></span></code></pre></div><h1 id=finalizing>Finalizing</h1><p>Then restart DarkTable and the lens correction should now be present.</p><p>This update will work at least until the next update &ndash; but presumably the update will include the data we added, so that&rsquo;s not an issue.</p><p><img src=/static/images/dark-woods.jpg alt="A path diverged in the wood and I&amp;hellip; nope, not that. A maze of twisty passages, all.. nope. Eh. The forest is dark, green, and impenetrable. The forest floor is covered in brown leaves. We can see through a gap between the trees to a small clearing, where the ground is green and the sunlight lights the ground and the leaves which hang into the clearing."></p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=/2022/04/03/website-hosting-changed/>Website hosting changed</a></li><li><a href=/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=/categories/3d-printing/>3D Printing</a></li><li><a href=/categories/acm/>ACM</a></li><li><a href=/categories/acm-cluster/>ACM Cluster</a></li><li><a href=/categories/cyberlaw/>Cyberlaw</a></li><li><a href=/categories/cybersecurity/>Cybersecurity</a></li><li><a href=/categories/germany/>Germany</a></li><li><a href=/categories/infrastructure/>Infrastructure</a></li><li><a href=/categories/life-in-germany/>Life in Germany</a></li><li><a href=/categories/links/>Links</a></li><li><a href=/categories/presentations/>Presentations</a></li><li><a href=/categories/projects/>Projects</a></li><li><a href=/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>