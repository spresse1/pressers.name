<!doctype html><html lang=en><head><title>Building the ACM Cluster, Part 11e: Building Ceph - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ceph is a distributed storage engine. It can be used in a whole number of different ways - for example, as a block device or an object store. The current version is codenamed argonaut, hence the header image.
In the ACM cluster, we&rsquo;re using it as the storage engine for VMs. This makes a lot of sense in our case, as the VMs are going to want to move from machine to machine and this stops them having to copy the disk image."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2012/12/16/building-acm-cluster-part-11e-building-ceph/>Building the ACM Cluster, Part 11e: Building Ceph</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/acm-cluster/building-acm-cluster-part-11e-building-ceph.md><header class=entry-header><h1 class=entry-title><a href=/2012/12/16/building-acm-cluster-part-11e-building-ceph/>Building the ACM Cluster, Part 11e: Building Ceph</a></h1><p class=entry-info>Published on <time>Sun, Dec 16, 2012</time>
in ACM, ACM Cluster</p></header><div class=entry-body><p><a href=http://ceph.com/>Ceph</a> is a distributed storage engine.  It can be used in a whole number of different ways - for example, as a block device or an object store.  The current version is codenamed argonaut, hence the header image.</p><p>In the ACM cluster, we&rsquo;re using it as the storage engine for VMs.  This makes a lot of sense in our case, as the VMs are going to want to move from machine to machine and this stops them having to copy the disk image.  Ceph also has the advantage of being kernel-mainline, meaning that all the required bits for it are already built into the kernel and building it does not require patching the kernel at all.</p><h1 id=building-rpms>Building RPMs</h1><p>Building the Ceph RPMs is very similar to the other RPM builds we&rsquo;ve already done.  Ceph is extraordinarily kind and provides their own (working!) spec file.  So first off, download the Ceph <a href=http://ceph.com/resources/downloads/>tar.bz2 from here</a>.  Assuming you&rsquo;re using the same ceph 0.48-argonaut version I am, you&rsquo;ll then want to run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$  tar xvf ceph-0.48argonaut.tar.bz2 ceph-0.48argonaut/ceph.spec
</span></span></code></pre></div><p>to extract the spec file.  Now copy the spec file to <code>rpmbuild/SPECS</code> and the tar.bz2 to <code>rpmbuild/SOURCES</code>.</p><p>There is one dependency to Ceph that we can&rsquo;t satisfy out of the CentOS repositories.  The rados gateway portion of Ceph requires a fastcgi implementation.  We don&rsquo;t use it in our stack so what I&rsquo;ve done is a bit of a hack.  I found it was simpler to just provide an RPM to satisfy this and then ignore the built package (that is, not inject it into the repository) and that this didn&rsquo;t cause any harm.  The missing package is called fcgi-devel.  It is available in Fedora EPEL (extra packages for enterprise linux) repository.  Because there are various other subdependancies, the easiest thing to do is <a href=http://linux.mirrors.es.net/fedora-epel/6/i386/repoview/epel-release.html>add EPEL</a> to the machine we&rsquo;re building on.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># rpm -i &#39;http://linux.mirrors.es.net/fedora-epel/6/i386/epel-release-6-7.noarch.rpm&#39;</span>
</span></span></code></pre></div><p>This is one other good reason to have a machine we&rsquo;re building on that is easily wiped - we can add whole other repositories without really caring.</p><p>Now, lets build Ceph.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ rpmbuild -ba rpmbuild/SPECS/ceph.spec
</span></span></code></pre></div><p>(Again, you may need the <a href=/2012/12/15/building-acm-cluster-part-11a-setting-rpmbuild-environment/>magical &ldquo;install dependencies&rdquo; line from part 11a</a>).</p><p>Ceph will chew for a bit (longer than the kernel, less time than Xen), then spit out RPMs as before.  Inject them <a href=http://localhost:9090/2012/12/15/building-acm-cluster-part-11b-kernel-rpm-build/>as in part 11b</a>, and you&rsquo;re all set with Ceph!</p><p>There are two options for cleaning up before we continue:</p><ol><li><p>Remove EPEL</p><p><code># rpm -e epel-release</code></p></li><li><p>Reinstall the node - Make sure you copy the built packages off it first!</p></li></ol></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=/2022/04/03/website-hosting-changed/>Website hosting changed</a></li><li><a href=/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=/categories/3d-printing/>3D Printing</a></li><li><a href=/categories/acm/>ACM</a></li><li><a href=/categories/acm-cluster/>ACM Cluster</a></li><li><a href=/categories/cyberlaw/>Cyberlaw</a></li><li><a href=/categories/cybersecurity/>Cybersecurity</a></li><li><a href=/categories/germany/>Germany</a></li><li><a href=/categories/infrastructure/>Infrastructure</a></li><li><a href=/categories/life-in-germany/>Life in Germany</a></li><li><a href=/categories/links/>Links</a></li><li><a href=/categories/presentations/>Presentations</a></li><li><a href=/categories/projects/>Projects</a></li><li><a href=/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>