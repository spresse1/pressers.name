<!doctype html><html lang=en><head><title>Building the ACM Cluster, part 11f: ZFS on Linux - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ZFS is one of those pieces of software that is almost frighteningly good at what it does. It has a whole slew of features that make it, for many uses, the perfect filesystem. These include: deduplication, compression, data integrity guarantees (ZFS can detect and repair silent data corruption), copy-on-write architecture and a built in concept of RAID. The only problem is that the source is under a license incompatible with the linux kernel, so it will never be kernel mainline."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2012/12/16/building-acm-cluster-part-11f-zfs-linux/>Building the ACM Cluster, part 11f: ZFS on Linux</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/acm-cluster/building-acm-cluster-part-11f-zfs-linux.md><header class=entry-header><h1 class=entry-title><a href=/2012/12/16/building-acm-cluster-part-11f-zfs-linux/>Building the ACM Cluster, part 11f: ZFS on Linux</a></h1><p class=entry-info>Published on <time>Sun, Dec 16, 2012</time>
in ACM, ACM Cluster</p></header><div class=entry-body><p><a href=http://www.oracle.com/technetwork/server-storage/solaris11/technologies/zfs-338092.html>ZFS</a> is one of those pieces of software that is almost frighteningly good at what it does.  It has a whole slew of features that make it, for many uses, the perfect filesystem.  These include: deduplication, compression, data integrity guarantees (ZFS can detect and repair silent data corruption), copy-on-write architecture and a built in concept of RAID.  The only problem is that the source is under a license incompatible with the linux kernel, so it will never be kernel mainline.  There is, however, the <a href=http://zfsonlinux.org/>ZFS on linux</a> project, which makes it easy to bring ZFS to several linux distributions.</p><h1 id=building-zfs>Building ZFS</h1><p>Download the SPL and ZFS packages from the <a href=http://zfsonlinux.org/>ZFS on Linux</a> homepage.</p><h2 id=building-spl>Building SPL</h2><p>The main ZFS package requires that parts of SPL (the Solaris portability layer) be installed before ZFS can be installed.  So lets start by untaring SPL.  At the time of writing, the most recent version is 0.6.0-rc12:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tar xf spl-0.6.0-rc12.tar.gz
</span></span></code></pre></div><p>Now, lets build the RPMs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cd spl-0.6.0-rc12
</span></span><span style=display:flex><span>$ ./configure
</span></span><span style=display:flex><span>$ make rpm
</span></span></code></pre></div><p>This builds SPL RPMs required and leaves them in the current directory.  That was simple.</p><h2 id=install-spl-devel>Install spl-devel</h2><p>Remember I said some of SPL had to be installed for ZFS to build?  The package that must be installed is called spl-devel.  Install it by running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># rpm -i spl-modules-devel-0.6.0-rc12_3.6.9_1.el6.x86_64.rpm</span>
</span></span></code></pre></div><h1 id=building-zfs-1>Building ZFS</h1><p>Before you build ZFS, you&rsquo;ll want to install a couple of dependancies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># yum install -y zlib-devel libuuid-devel</span>
</span></span></code></pre></div><p>Alright now lets untar ZFS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tar xf zfs-0.6.0-rc12.tar.gz
</span></span></code></pre></div><p>and run (almost) the same commands as before:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ./configure
</span></span><span style=display:flex><span>$ QA_RPATHS<span style=color:#f92672>=</span>$<span style=color:#f92672>[</span> 0x0002 <span style=color:#f92672>]</span> make rpm
</span></span></code></pre></div><p>The QA_RPATHS setting was required on my machine in order to deal with ZFS creating some slightly weird paths in the package.  However, they didn&rsquo;t seem to cause any problems.  If it weirds you out, leave it off and see what happens - it may be a fluke of something on the machine I was building on.</p><h1 id=finalization>Finalization</h1><p>Now that ZFS and SPL are built, copy the RPMs to your xCat head node, then <a href=/2012/12/15/building-acm-cluster-part-11b-kernel-rpm-build/>inject them into the package repository as before</a>.</p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=/2022/04/03/website-hosting-changed/>Website hosting changed</a></li><li><a href=/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=/categories/3d-printing/>3D Printing</a></li><li><a href=/categories/acm/>ACM</a></li><li><a href=/categories/acm-cluster/>ACM Cluster</a></li><li><a href=/categories/cyberlaw/>Cyberlaw</a></li><li><a href=/categories/cybersecurity/>Cybersecurity</a></li><li><a href=/categories/germany/>Germany</a></li><li><a href=/categories/infrastructure/>Infrastructure</a></li><li><a href=/categories/life-in-germany/>Life in Germany</a></li><li><a href=/categories/links/>Links</a></li><li><a href=/categories/presentations/>Presentations</a></li><li><a href=/categories/projects/>Projects</a></li><li><a href=/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>