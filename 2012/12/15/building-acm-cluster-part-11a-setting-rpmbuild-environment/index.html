<!doctype html><html lang=en><head><title>Building the ACM Cluster, Part 11a: Setting up rpmbuild environment - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Up to this point, we haven&rsquo;t built any custom software for the cluster. I&rsquo;ve tried very hard to use mostly off the shelf software. However, this has to change. Several of the major components we&rsquo;re going to use (xen, the fiber card driver, ceph) are not available in the CentOS repositories (or are too old). So we&rsquo;re going to build them ourselves.
However, rather than build them on a node-by node basis (which would make a single install hours long&mldr;), we&rsquo;re going to build packages."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2012/12/15/building-acm-cluster-part-11a-setting-rpmbuild-environment/>Building the ACM Cluster, Part 11a: Setting up rpmbuild environment</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/acm-cluster/building-acm-cluster-part-11a-setting-rpmbuild-environment.md><header class=entry-header><h1 class=entry-title><a href=/2012/12/15/building-acm-cluster-part-11a-setting-rpmbuild-environment/>Building the ACM Cluster, Part 11a: Setting up rpmbuild environment</a></h1><p class=entry-info>Published on <time>Sat, Dec 15, 2012</time>
in ACM, ACM Cluster</p></header><div class=entry-body><p>Up to this point, we haven&rsquo;t built any custom software for the cluster.  I&rsquo;ve tried very hard to use mostly off the shelf software.  However, this has to change.  Several of the major components we&rsquo;re going to use (xen, the fiber card driver, ceph) are not available in the CentOS repositories (or are too old).  So we&rsquo;re going to build them ourselves.</p><p>However, rather than build them on a node-by node basis (which would make a single install hours long&mldr;), we&rsquo;re going to build packages.  CentOS uses the rpm package format to distribute prebuilt software.  So we&rsquo;ll be building RPMs.</p><h1 id=where-do-i-build-rpms>Where do I build RPMs?</h1><p>Many resources recommend not building RPMs as root.  This is quite sensible if you&rsquo;re doing it on a machine that can&rsquo;t easily be rebuilt - that way you can&rsquo;t accidentally overwrite an important file.  However, since you </p><h1 id=installing-rpmbuild>Installing rpmbuild</h1><p>The primary tool used to build rpms is called, obviously enough rpmbuild.  We also need a package called rpmdevtools to get the proper environment set up.  Lets get them installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># yum install -y rpmbuild rpmdevtools</span>
</span></span></code></pre></div><h1 id=set-up-the-basic-environment>Set up the Basic Environment</h1><p>Run </p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ rpmdev-setuptree
</span></span></code></pre></div><p>This creates a file tree that looks something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ls rpmbuild/
</span></span><span style=display:flex><span>BUILD  RPMS  SOURCES  SPECS  SRPMS
</span></span></code></pre></div><p>Each of these directories starts off empty, but here is what will eventually go in each:</p><ul><li>BUILD - the directory the rpmbuild tool works in.  You&rsquo;ll probably never interact directly with this directory.</li><li>RPMS - the output directory, where rpmbuild will put the packages RPMs</li><li>SOURCES - the input files needed to build the RPMs.  Typically a tarball plus perhaps some other supporting files.</li><li>SPECS - A directory which contains the files that tell rpmbuild how to build and package the software.  We&rsquo;ll get more into spec files much later.</li><li>SRPMS - SRPMS are the source packages used to build RPMs.  We probably won&rsquo;t interact with this directory, since we only intend to redistribute binaries.</li></ul><h1 id=a-useful-command>A Useful Command</h1><p>One thing that you&rsquo;ll often find in the process of building RPMs is that rpmbuild will tell you you&rsquo;re missing dependencies.  Rather than going through and manually installing each of the dependencies, you can use the following to automatically install the dependencies.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ yum install -y <span style=color:#e6db74>`</span>rpmbuild -ba <span style=color:#f92672>[</span>SPECFILE<span style=color:#f92672>]</span> 2&gt;&amp;<span style=color:#ae81ff>1</span> | grep <span style=color:#e6db74>&#39;is needed by&#39;</span> | awk <span style=color:#e6db74>&#39;{print $1}&#39;</span> | xargs<span style=color:#e6db74>`</span>
</span></span></code></pre></div><p>where <code>[SPECFILE]</code> is the spec file you&rsquo;re attempting to use.</p><h1 id=next-up-building-packages>Next up: Building packages</h1><p>This part on building required RPMs is going to be long and so is split into several posts.  I&rsquo;ll update this section with links to the other posts as we go.</p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=https://pressers.name/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=https://pressers.name/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=https://pressers.name/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=https://pressers.name/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li><li><a href=https://pressers.name/2021/01/23/i-finally-finished-kings-quest-6/>I Finally Finished King's Quest 6!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=https://pressers.name/categories/3d-printing/>3D Printing</a></li><li><a href=https://pressers.name/categories/acm/>ACM</a></li><li><a href=https://pressers.name/categories/acm-cluster/>ACM Cluster</a></li><li><a href=https://pressers.name/categories/cyberlaw/>Cyberlaw</a></li><li><a href=https://pressers.name/categories/cybersecurity/>Cybersecurity</a></li><li><a href=https://pressers.name/categories/germany/>Germany</a></li><li><a href=https://pressers.name/categories/infrastructure/>Infrastructure</a></li><li><a href=https://pressers.name/categories/life-in-germany/>Life in Germany</a></li><li><a href=https://pressers.name/categories/links/>Links</a></li><li><a href=https://pressers.name/categories/presentations/>Presentations</a></li><li><a href=https://pressers.name/categories/projects/>Projects</a></li><li><a href=https://pressers.name/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>