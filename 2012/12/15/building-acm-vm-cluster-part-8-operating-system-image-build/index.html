<!doctype html><html lang=en><head><title>Building the ACM VM Cluster, Part 10: Operating system image build - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Now that we&rsquo;re done with network configuration. Now, lets actually build an operating system to use on the nodes!
Lets go ISO Huntin'! The first step in building operating system install images is to get the full operating system images. Not netboot, but a fully installable version. For CentOS the mirrors page is a good place to start your hunt. Personally, I downloaded both DVD images (CentOS-6.3-x86_64-bin-DVD1.iso and CentOS-6.3-x86_64-bin-DVD2.iso), though I suspect that simply the minimal image will cover it."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2012/12/15/building-acm-vm-cluster-part-8-operating-system-image-build/>Building the ACM VM Cluster, Part 10: Operating system image build</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/acm-cluster/building-acm-vm-cluster-part-8-operating-system-image-build.md><header class=entry-header><h1 class=entry-title><a href=/2012/12/15/building-acm-vm-cluster-part-8-operating-system-image-build/>Building the ACM VM Cluster, Part 10: Operating system image build</a></h1><p class=entry-info>Published on <time>Sat, Dec 15, 2012</time>
in ACM, ACM Cluster</p></header><div class=entry-body><p>Now that we&rsquo;re done with network configuration.  Now, lets actually build an operating system to use on the nodes!</p><h1 id=lets-go-iso-huntin>Lets go ISO Huntin'!</h1><p>The first step in building operating system install images is to get the full operating system images.  Not netboot, but a fully installable version.  For CentOS the <a href="http://www.centos.org/modules/tinycontent/index.php?id=30">mirrors page</a> is a good place to start your hunt.  Personally, I downloaded both DVD images (CentOS-6.3-x86_64-bin-DVD1.iso and CentOS-6.3-x86_64-bin-DVD2.iso), though I suspect that simply the minimal image will cover it.</p><h1 id=import-install-media>Import Install Media</h1><p>Next, we have to import the install media to xCat&rsquo;s NFS filesystem.  To do this, we&rsquo;ll use the <code>copycds</code> command.  <code>copycds</code> takes as arguments simply the ISOs you want to import:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># copycds CentOS-6.3-x86_64-bin-DVD1.iso CentOS-6.3-x86_64-bin-DVD2.iso</span>
</span></span></code></pre></div><p>Sometimes copycds will tell you</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Error: copycds could not identify the ISO supplied, you may wish to try -n &lt;osver&gt;
</span></span></code></pre></div><p>In which case your command will look more like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># copycds -n centos6.3 CentOS-6.3-x86_64-bin-DVD1.iso CentOS-6.3-x86_64-bin-DVD2.iso</span>
</span></span></code></pre></div><h1 id=set-root-password>Set Root Password</h1><p>You probably will never need to log directly on to a node using a password (and xCat is nice and sets up ssh keys for you),  but lets set the root password on the nodes anyway:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># tabch key=system,username=root passwd.password=[your password]</span>
</span></span></code></pre></div><h1 id=test-kickstarting>Test Kickstarting</h1><p>Now we&rsquo;ve got everything set up to try installing a node.  Note that this will just be a very generic install.  However, this seems to be a good time to test this before we start getting complicated in terms of making images.</p><p>So lets set node001 to kickstart from the generic compute image:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodech node001 nodetype.os=centos6.3 nodetype.arch=x86_64 nodetype.profile=compute</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodeset node001 install</span>
</span></span></code></pre></div><p>This second line mail fail.  In this is the case, xCat wants you to boot up the node once so it can do autodiscovery (find the mac address).  Without this it cannot set up the TFTP server to properly boot the node.  I recommend that you boot all the nodes, let xCat do autodiscovery, set the nodes to install, then reboot them.</p><p>Assuming you&rsquo;ve got discivery working and were able to set the node to install, boot the node.  Note that if your machines have remote power that is properly built into xCat (unlike mine), you&rsquo;ll probably also want to have them do the appropriate setup (bmcsetup, for example).  See this <a href=http://sumavi.com/sections/under-the-hood-of-the-xcat-service-image>sumavi page for more details on the chain setup</a>.</p><p>If all goes well, you ought to see something like this in <code>/var/log/messages</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Sep <span style=color:#ae81ff>14</span> 16:56:12 bosca in.tftpd<span style=color:#f92672>[</span>3188<span style=color:#f92672>]</span>: RRQ from 172.18.0.1 filename pxelinux.0
</span></span><span style=display:flex><span>Sep <span style=color:#ae81ff>14</span> 16:56:12 bosca in.tftpd<span style=color:#f92672>[</span>3188<span style=color:#f92672>]</span>: tftp: client does not accept options
</span></span><span style=display:flex><span>Sep <span style=color:#ae81ff>14</span> 16:56:12 bosca in.tftpd<span style=color:#f92672>[</span>3189<span style=color:#f92672>]</span>: RRQ from 172.18.0.1 filename pxelinux.0
</span></span><span style=display:flex><span>Sep <span style=color:#ae81ff>14</span> 16:56:12 bosca in.tftpd<span style=color:#f92672>[</span>3190<span style=color:#f92672>]</span>: RRQ from 172.18.0.1 filename pxelinux.cfg/00020003-0004-0005-0006-000700080009
</span></span><span style=display:flex><span>Sep <span style=color:#ae81ff>14</span> 16:56:12 bosca in.tftpd<span style=color:#f92672>[</span>3191<span style=color:#f92672>]</span>: RRQ from 172.18.0.1 filename pxelinux.cfg/01-00-e0-81-2b-44-75
</span></span><span style=display:flex><span>Sep <span style=color:#ae81ff>14</span> 16:56:12 bosca in.tftpd<span style=color:#f92672>[</span>3192<span style=color:#f92672>]</span>: RRQ from 172.18.0.1 filename pxelinux.cfg/AC120001
</span></span></code></pre></div><p>Which indicates that the node is booting.  If you then check /var/log/httpd/access_logs, you&rsquo;ll see:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:33:42 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/autoinst/node001 HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>13912</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;anaconda/13.21.176&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:33:46 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/images/updates.img HTTP/1.1&#34;</span> <span style=color:#ae81ff>404</span> <span style=color:#ae81ff>317</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;anaconda/13.21.176&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:33:46 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/images/product.img HTTP/1.1&#34;</span> <span style=color:#ae81ff>404</span> <span style=color:#ae81ff>317</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;anaconda/13.21.176&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:33:46 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/images/install.img HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>136585216</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;anaconda/13.21.176&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:34:35 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/.treeinfo HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>398</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;urlgrabber/3.9.1&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:34:35 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/.treeinfo HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>398</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;urlgrabber/3.9.1&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:34:35 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/repodata/repomd.xml HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>4136</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;CentOS (anaconda)/6.3&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:34:35 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/repodata/018dd5e8db1fe55ccd4fd96d3b1daaa5782b34d254cc7766a0eb9d1ac7e1be0d-primary.sqlite.bz2 HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>4673840</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;CentOS (anaconda)/6.3&#34;</span>
</span></span><span style=display:flex><span>172.18.0.1 - - <span style=color:#f92672>[</span>14/Sep/2012:16:34:37 -0400<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /install/centos6.3/x86_64/repodata/0dae8d32824acd9dbdf7ed72f628152dd00b85e4bd802e6b46e4d7b78c1042a3-c6-x86_64-comps.xml HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>1186698</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;CentOS (anaconda)/6.3&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ve truncated the output here, just for length.  The install process pulls many dozens of files and, in the case of CentOS takes about 15-30 minutes.  Assuming all goes well, you&rsquo;ll be able to ssh into your test node.  If that went well, go on forward.  If not, some good places to look for hints are <code>/var/log/messages</code> and <code>/var/log/httpd/access_log</code>.  Worst to worst, use wireshark to see whats going on on the network. If you&rsquo;re stuck, the <a href=https://lists.sourceforge.net/lists/listinfo/xcat-user>xcat-users list</a> is a great place to ask for help.  Be sure to be as detailed as you can be!</p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=/2022/04/03/website-hosting-changed/>Website hosting changed</a></li><li><a href=/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=/categories/3d-printing/>3D Printing</a></li><li><a href=/categories/acm/>ACM</a></li><li><a href=/categories/acm-cluster/>ACM Cluster</a></li><li><a href=/categories/cyberlaw/>Cyberlaw</a></li><li><a href=/categories/cybersecurity/>Cybersecurity</a></li><li><a href=/categories/germany/>Germany</a></li><li><a href=/categories/infrastructure/>Infrastructure</a></li><li><a href=/categories/life-in-germany/>Life in Germany</a></li><li><a href=/categories/links/>Links</a></li><li><a href=/categories/presentations/>Presentations</a></li><li><a href=/categories/projects/>Projects</a></li><li><a href=/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>