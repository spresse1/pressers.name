<!doctype html><html lang=en><head><title>Building the ACM Cluster, Part 6: Network Configuration - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In part 5 of this series, I covered the generic xCat setup and we told it how the network was set up. We&rsquo;ve done little bits of network setup before (like setting our switches up for SNMP read access in the public community). Now we&rsquo;re going to do quite a bit more.
Telling xCat where Nodes Are xCat has this wonderful ability to know what a newly plugged in machine is, based on where it is on a switch."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2012/09/09/building-acm-cluster-part-6-network-configuration/>Building the ACM Cluster, Part 6: Network Configuration</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/acm-cluster/building-acm-cluster-part-6-network-configuration.md><header class=entry-header><h1 class=entry-title><a href=/2012/09/09/building-acm-cluster-part-6-network-configuration/>Building the ACM Cluster, Part 6: Network Configuration</a></h1><p class=entry-info>Published on <time>Sun, Sep 9, 2012</time>
in ACM, ACM Cluster</p></header><div class=entry-body><p>In <a href=/2012/09/09/building-acm-vm-cluster-part-5-xcat-configuration/>part 5</a> of this series, I covered the generic xCat setup and we told it how the network was set up.  We&rsquo;ve done little bits of network setup before (like setting our switches up for SNMP read access in the public community).  Now we&rsquo;re going to do quite a bit more.</p><h1 id=telling-xcat-where-nodes-are>Telling xCat where Nodes Are</h1><p>xCat has this wonderful ability to know what a newly plugged in machine is, based on where it is on a switch.  In my case, I have the first management node on eth-switch1&rsquo;s 1st port, second management on the second port.  I then have the fiber switch&rsquo;s management interface on the 3rd port, and nodes are ports 4-20.  The following set of commands encapsulates this, though you&rsquo;ll note that I&rsquo;ve intentionally not made any entries for the management nodes - no point in confusing xCat by doing so.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodech myricom-switch switch.switch=eth-switch1 switch.port=3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodech compute switch.switch=eth-switch1 switch.port=&#39;|\D+(\d+)$|($1+3)|&#39;</span>
</span></span></code></pre></div><p>Notice that I&rsquo;ve again used a regexp to assign ports.</p><h1 id=peek-at-how-xcat-sees-networks>Peek at How xCat Sees Networks</h1><p>One of the many &ldquo;cool&rdquo; features of xCat is network auto-detection on start.  So lets see how xCat sees the network around it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tabdump networks
</span></span></code></pre></div><p>Heres what my unconfigured output looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#netname,net,mask,mgtifname,gateway,dhcpserver,tftpserver,nameservers,ntpservers,logservers,dynamicrange,nodehostname,ddnsdomain,vlanid,domain,comments,disable</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;10_1_10_0-255_255_255_0&#34;</span>,<span style=color:#e6db74>&#34;10.1.10.0&#34;</span>,<span style=color:#e6db74>&#34;255.255.255.0&#34;</span>,<span style=color:#e6db74>&#34;eth0&#34;</span>,<span style=color:#e6db74>&#34;10.1.10.1&#34;</span>,,<span style=color:#e6db74>&#34;10.1.10.114&#34;</span>,,,,,,,,,,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;172_16_0_0-255_240_0_0&#34;</span>,<span style=color:#e6db74>&#34;172.16.0.0&#34;</span>,<span style=color:#e6db74>&#34;255.240.0.0&#34;</span>,<span style=color:#e6db74>&#34;eth1&#34;</span>,<span style=color:#e6db74>&#34;&lt;xcatmaster&gt;&#34;</span>,,<span style=color:#e6db74>&#34;172.16.0.2&#34;</span>,,,,,,,,,,
</span></span></code></pre></div><p>(Note: 10.1.10.0/24 is my upstream router while building this cluster).</p><p>Those network names are rather ugly, aren&rsquo;t they?  Lets fix those:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># chtab netname=10_1_10_0-255_255_255_0 networks.netname=&#34;external&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># chtab netname=&lt;span&gt;172_16_0_0-255_240_0_0&lt;/span&gt; networks.netname=&#34;internal&#34;</span>
</span></span></code></pre></div><p>Now, lets configure the internal network:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># chtab netname=internal networks.gateway=172.16.0.1 networks.dhcpserver=172.16.0.1 networks.tftpserver=172.16.0.1 networks.ntpservers=&#34;172.16.0.1&#34; networks.logservers=&#34;172.16.0.1&#34;</span>
</span></span></code></pre></div><h1 id=set-up-dhcp-ranges>Set up DHCP Ranges</h1><p>Throughout all of this I&rsquo;ve been referring to xCat&rsquo;s ability to autodetect nodes.  One of the things it need to do this is a range of IP addresses it can give out to nodes that it doesn&rsquo;t know yet.  In my case, I&rsquo;ve designated 172.22.0.0/15 as the DHCP range.  So lets tell xCat this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># chtab netname=internal networks.dynamicrange=172.22.0.1-172.23.255.254</span>
</span></span></code></pre></div><h1 id=network-cleanup>Network Cleanup</h1><p>xCat uses a magic discovery kernel to find new nodes on the network.  Whenever we make changes to the network configuration, we have to regenerate it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># mknb x86_64</span>
</span></span></code></pre></div><p>Now, lets rebuild our network configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># makedns</span>
</span></span></code></pre></div><p>And lets restart DNS, then make sure that DNS will start properly on reboot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># service named restart</span>
</span></span><span style=display:flex><span><span style=color:#75715e># chkconfig --level 345 named on</span>
</span></span></code></pre></div><h1 id=tell-nodes-where-to-find-important-details>Tell Nodes where to find Important Details</h1><p>We need to tell xCat what the installation setup of the nodes is.  To do this, run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodegrpch compute noderes.primarynic=eth0 noderes.tftpserver=[management node name] noderes.installnic=eth0 noderes.nfsserver=[management node name] noderes.netboot=pxe</span>
</span></span></code></pre></div><p>In this command, we&rsquo;ve told the compute nodes which network interface they should use by default and where to find our management node for both tftp and nfs, which will be needed in the install process.</p><h1 id=dhcp>DHCP</h1><p>Now lets make a DHCP configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># makedhcp --new</span>
</span></span></code></pre></div><p>And start DHCP, then make sure it autostarts on boot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># service dhcpd start</span>
</span></span><span style=display:flex><span><span style=color:#75715e># chkconfig --level 345 dhcpd on</span>
</span></span></code></pre></div><h1 id=add-non-autodiscoverable-mac-addresses>Add Non-autodiscoverable MAC Addresses</h1><p>Some nodes (in my case, all of the switches) are not auto-discoverable.  If this is the case, you&rsquo;ll need to manually tell xCat what the mac address is.  That can be done with a command like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodech [node] mac.mac=[macaddr, with colons]</span>
</span></span></code></pre></div><h1 id=conclusion>Conclusion</h1><p>In the part we did rather a lot, didn&rsquo;t we?  We configured the network and started two new services - named and dhcpd - which will be critical to autodiscovering nodes.  Next up, we&rsquo;ll be building an operating system image for the nodes.</p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=https://pressers.name/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=https://pressers.name/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=https://pressers.name/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=https://pressers.name/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li><li><a href=https://pressers.name/2021/01/23/i-finally-finished-kings-quest-6/>I Finally Finished King's Quest 6!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=https://pressers.name/categories/3d-printing/>3D Printing</a></li><li><a href=https://pressers.name/categories/acm/>ACM</a></li><li><a href=https://pressers.name/categories/acm-cluster/>ACM Cluster</a></li><li><a href=https://pressers.name/categories/cyberlaw/>Cyberlaw</a></li><li><a href=https://pressers.name/categories/cybersecurity/>Cybersecurity</a></li><li><a href=https://pressers.name/categories/germany/>Germany</a></li><li><a href=https://pressers.name/categories/infrastructure/>Infrastructure</a></li><li><a href=https://pressers.name/categories/life-in-germany/>Life in Germany</a></li><li><a href=https://pressers.name/categories/links/>Links</a></li><li><a href=https://pressers.name/categories/presentations/>Presentations</a></li><li><a href=https://pressers.name/categories/projects/>Projects</a></li><li><a href=https://pressers.name/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>