<!doctype html><html lang=en><head><title>Building the ACM VM Cluster, Part 5: xCat configuration - The Electronic Press</title><meta charset=utf-8><meta http-equiv=cache-control content="public"><meta name=robots content="follow, all"><meta name=language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In part 4 of this series, we installed xCat. Now its time to configure it.
But First&mldr; But first, lets talk a little about how you interact with xCat. xCat stores its configuration files in &ldquo;tab&#34;s - tables. In the default case, these are sqlite tables, though some will try to convince you to change it to MySQL. Unless you&rsquo;re running thousands of nodes or continually hitting xCat, I see no point in this changeover and therefore will not cover it."><meta name=keywords content><link rel=alternate type=application/rss+xml title="RSS Feed for pressers.name" href=/index.xml><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/base.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/cssmenu.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/menustyling.css><link rel=stylesheet type=text/css media="screen, projection" href=/static/css/blog.css><link rel=stylesheet type=text/css media=print href=/static/css/print.css></head><body><div id=skip><a href=#content>Skip to Main Content</a></div><div id=leftbar></div><div id=contentwrapper><div id=header><div id=titleimagediv></div><div id=twotraces><div id=twotracesright>&nbsp;</div></div></div><div class=menu id=topmenu><nav><ul class=top-navigation><li><a href=/ title=Home rel=home>Home</a></li><li><a href=http://github.com/spresse1>GitHub</a></li><li><a href=/contact>Contact</a></li></ul></nav></div><div id=onetrace><div id=onetraceleft></div><div id=breadcrumbs class=breadcrumbs><nav><ul class=breadcrumbs><li><a href=/>Home</a></li><li><a href=/blog/>Blogs</a></li><li><a href=/2012/09/09/building-acm-vm-cluster-part-5-xcat-configuration/>Building the ACM VM Cluster, Part 5: xCat configuration</a></li></ul></nav></div></div><div id=bodywrapper><div id=content><div id=contentborder></div><div id=innercontent><main><div class=hentry><article itemtype=http://schema.org/Article itemscope id=blog/acm-cluster/building-acm-vm-cluster-part-5-xcat-configuration.md><header class=entry-header><h1 class=entry-title><a href=/2012/09/09/building-acm-vm-cluster-part-5-xcat-configuration/>Building the ACM VM Cluster, Part 5: xCat configuration</a></h1><p class=entry-info>Published on <time>Sun, Sep 9, 2012</time>
in ACM, ACM Cluster</p></header><div class=entry-body><p>In <a href=/2012/09/09/building-acm-vm-cluster-part-4-xcat-install/>part 4 of this series</a>, we installed xCat.  Now its time to configure it.</p><h1 id=but-first>But First&mldr;</h1><p>But first, lets talk a little about how you interact with xCat.  xCat stores its configuration files in &ldquo;tab"s - tables.  In the default case, these are sqlite tables, though some will try to convince you to change it to MySQL.  Unless you&rsquo;re running thousands of nodes or continually hitting xCat, I see no point in this changeover and therefore will not cover it.</p><p>Interaction with xCat happens primarily through three commands: <code>chnode</code>, <code>chtab</code> and <code>tabedit</code>.  However, <code>nodels</code> and <code>tabdump</code> are also useful for seeing what xCat got out of your input.  For detail on these commands, read the man pages for each.  However, here is a quick summary:</p><ul><li><code>chnode</code>: change configuration details on a node</li><li><code>chtab</code>: Change configuration by key in a table</li><li><code>tabedi</code>t: Manually edit a table</li><li><code>nodels</code>: show all details associated with a particular node</li><li><code>tabdump</code>: show the data stored in a tab</li></ul><p>If you&rsquo;re looking for information on a table try:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ man <span style=color:#ae81ff>5</span> <span style=color:#f92672>[</span>tablename<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>assuming you installed the man command.  (See, there was a reason I mentioned it!)</p><h1 id=change-some-config>Change some Config!</h1><h2 id=site-setup>Site Setup</h2><p>xCat stores most of its global setting in the &ldquo;site&rdquo; table.  So lets edit that one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># tabedit site</span>
</span></span></code></pre></div><p>Okay, now we have to make things work just as we expect.  So we have to change some critical default values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#e6db74>&#34;forwarders&#34;</span>,<span style=color:#e6db74>&#34;[your external dns servers]&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;master&#34;</span>,<span style=color:#e6db74>&#34;[Master node name]&#34;</span>,,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;nameservers&#34;</span>,<span style=color:#e6db74>&#34;172.16.0.1&#34;</span>,,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;ntpservers&#34;</span>,<span style=color:#e6db74>&#34;172.16.0.1&#34;</span>,,
</span></span></code></pre></div><p>Save and exit.  xCat will let you know if you&rsquo;ve made a syntactical mistake, to don&rsquo;t worry too much about those.  If you&rsquo;d like the domain name of your cluster set, you should also consider setting the &ldquo;domain&rdquo; attribute in the same way as the above.</p><h2 id=adding-nodes>Adding Nodes</h2><p>Now its time to add some nodes.  To do this, we&rsquo;ll use a new command, nodeadd and take advantage of its powerful regular expressions to add many nodes at once.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodeadd node[001-016] groups=compute,apc,vm,core</span>
</span></span></code></pre></div><p>Note that this adds node001 through node016 to the xCat database and puts them in the groups compute, apc, vm, and core, which represent generic nodes, those controlled by our APC switched PDUs, those running VMs, and &lsquo;core&rsquo; VM nodes - those which will run the ACM&rsquo;s core services.</p><p>Lets also add the management nodes while we&rsquo;re at it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodeadd master groups=management,masters</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodeadd master1 groups=management,masters</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodeadd master2 groups=management,masters</span>
</span></span></code></pre></div><p>In this case, I have added an entry for the shared IP address under the name master, then given each of the physical nodes that can run the master configuration the name master1 or master2.</p><p>And next, some switches:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodeadd eth-switch[1-4] groups=management,switches,eth-switches</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodeadd myricom-switch groups=management,switches,fiber-switches</span>
</span></span></code></pre></div><h2 id=give-nodes-addresses>Give Nodes Addresses</h2><p>The next thing we have to do is set up the static IP addressing for within the cluster.  We&rsquo;re going to be doing this through xCat, because it makes life simpler if configuration needs to only be changed in one place.  Lets start with the management nodes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodech master hosts.ip=172.16.0.1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodech master1 hosts.ip=172.16.0.2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodech master2 hosts.ip=172.16.0.3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodech myricom-switch hosts.ip=172.16.0.11</span>
</span></span></code></pre></div><p>Now, lets give the switches and compute nodes IP addresses:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodech eth-switches hosts.ip=&#39;|\D+(\d+)$|172.16.0.($1+4)|&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nodech compute hosts.ip=&#39;|\D+(\d+)$|172.18.0.($1+0)|&#39;</span>
</span></span></code></pre></div><p>These lines add the compute nodes, as a batch, so that they follow a regular expression.  This saves us having to put them all in individually.  Please do note that if you have more than 254 nodes (and therefore need to use more than just the 172.18.0.0/16 space) your regex will get more complicated.</p><p>Now, we have one last bit of other configuration to do - Assigning IP addresses for the fiber cards of the nodes.  To do this, we&rsquo;re going to use the &lsquo;otherinterfaces&rsquo; column of the hosts table.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># nodech compute hosts.otherinterfaces=&#39;|\D+(\d+)$|node($1)-fiber:172.20.0.($1+0)|&#39;</span>
</span></span></code></pre></div><h2 id=generate-etchosts>Generate /etc/hosts</h2><p>xCat can automatically generate /etc/hosts, which is then used by other servers on the system to know where to find and what to name nodes.  So.  Lets let xCat do the work for us and generate this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># makehosts</span>
</span></span></code></pre></div><p>Generally, whenever you make a change to the hosts table, you should rerun makehosts to regenerate <code>/etc/hosts</code>.</p><h1 id=conclusion>Conclusion</h1><p>So.  Now xCat knows about the network topology.  In the next section, we&rsquo;re actually going to set the network up!</p></div></article></div></main></div></div><div id=sidebar><div class=widget><nav><h1>Recent Posts</h1><ul class=entries-reent><li><a href=/2022/04/03/website-hosting-changed/>Website hosting changed</a></li><li><a href=/2022/02/01/enigma-2022/>Enigma 2022</a></li><li><a href=/2021/11/21/getting-new-lenses-lensfun-notes/>Getting new lenses for Lensfun</a></li><li><a href=/2021/10/04/living-germany-converting-drivers-license/>Living in Germany: Converting a Driver's License</a></li><li><a href=/2021/02/08/im-moving-germany/>I'm moving to Germany!</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Social Media</h1><ul class=socialmedia><li><a href=https://twitter.com/spresser>Twitter</a></li><li><a href=https://www.linkedin.com/in/steven-presser/>LinkedIn</a></li></ul></nav></div><div class=sidebarbender></div><div class=widget><nav><h1>Categories</h1><ul class=categories><li><a href=/categories/3d-printing/>3D Printing</a></li><li><a href=/categories/acm/>ACM</a></li><li><a href=/categories/acm-cluster/>ACM Cluster</a></li><li><a href=/categories/cyberlaw/>Cyberlaw</a></li><li><a href=/categories/cybersecurity/>Cybersecurity</a></li><li><a href=/categories/germany/>Germany</a></li><li><a href=/categories/infrastructure/>Infrastructure</a></li><li><a href=/categories/life-in-germany/>Life in Germany</a></li><li><a href=/categories/links/>Links</a></li><li><a href=/categories/presentations/>Presentations</a></li><li><a href=/categories/projects/>Projects</a></li><li><a href=/categories/shrubbery/>Shrubbery</a></li></ul></nav></div><div class=sidebarbender></div></div></div><div id=onetracebottom><footer><a href=https://github.com/spresse1/pressers.name>Website source</a><br>Site design by Kyle M.</footer></div></div></body></html>